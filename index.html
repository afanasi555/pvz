<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plants vs Zombies</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #87CEEB;
        }
        #gameCanvas {
            border: 1px solid #000;
            display: block;
            margin: 0 auto;
            background-image: url('https://github.com/afanasi555/pvz/blob/main/assets/res/lawnmower/lawnmower.png?raw=true');
            background-size: cover;
        }
        #statusBar {
            background: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10;
        }
        #shop {
            position: absolute;
            right: 0;
            top: 0;
            width: 200px;
            background: #fff;
            border: 1px solid #000;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }
        #shop img {
            width: 80px;
            height: 80px;
            cursor: pointer;
            margin: 5px;
        }
        #shop button {
            display: block;
            width: 100%;
            margin-top: 10px;
            padding: 10px;
            background: #f00;
            color: #fff;
            border: none;
            cursor: pointer;
        }
        #shop button:hover {
            background: #c00;
        }
        #endScreen {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: #fff;
            border: 1px solid #000;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            text-align: center;
            z-index: 30;
        }
        #endScreen img {
            width: 100px;
            height: 100px;
        }
        #progressBar {
            background: #444;
            color: #fff;
            padding: 5px;
            text-align: center;
            position: fixed;
            bottom: 0;
            width: 100%;
            z-index: 10;
        }
        .cell {
            width: 80px;
            height: 80px;
            border: 1px solid #999;
            float: left;
            position: relative;
        }
        #plantOptions {
            position: absolute;
            top: 100px;
            right: 0;
            width: 200px;
            background: #fff;
            border: 1px solid #000;
            padding: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            z-index: 20;
        }
        #plantOptions img {
            width: 80px;
            height: 80px;
            cursor: pointer;
            margin: 5px;
        }
        @media (max-width: 768px) {
            #gameCanvas {
                width: 100%;
                height: auto;
            }
            #plantOptions, #shop {
                width: 100%;
                right: 0;
                top: auto;
                bottom: 0;
            }
        }
    </style>
</head>
<body>
    <div id="statusBar">
        Coins: <span id="coins">50</span> | Suns: <span id="suns">0</span> | Lawn Mower Status: <span id="mowerStatus">Idle</span>
    </div>
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="plantOptions">
        <h3>Select Plant</h3>
        <img src="https://github.com/afanasi555/pvz/blob/main/assets/res/normal/sunflower1.png?raw=true" alt="Sunflower" data-type="sunflower" class="plant">
        <img src="https://github.com/afanasi555/pvz/blob/main/assets/res/normal/Peashooter1.png?raw=true" alt="Peashooter" data-type="peashooter" class="plant">
    </div>
    <div id="shop">
        <h3>Shop</h3>
        <img src="https://github.com/afanasi555/pvz/blob/main/assets/res/normal/sunflower1.png?raw=true" alt="Sunflower" data-type="sunflower" class="shop-item">
        <img src="https://github.com/afanasi555/pvz/blob/main/assets/res/normal/Peashooter1.png?raw=true" alt="Peashooter" data-type="peashooter" class="shop-item">
        <button id="closeShop">Close Shop</button>
    </div>
    <div id="endScreen">
        <img src="https://github.com/afanasi555/pvz/blob/main/assets/res/normal/sunflower1.png?raw=true" alt="Plant">
        <p>You won!</p>
        <button id="continueButton">Continue</button>
    </div>
    <div id="progressBar">Level Progress: <span id="progress">0%</span></div>
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const coinsElem = document.getElementById('coins');
        const sunsElem = document.getElementById('suns');
        const mowerStatusElem = document.getElementById('mowerStatus');
        const shop = document.getElementById('shop');
        const closeShopButton = document.getElementById('closeShop');
        const endScreen = document.getElementById('endScreen');
        const continueButton = document.getElementById('continueButton');
        const plantOptions = document.getElementById('plantOptions');
        const progressElem = document.getElementById('progress');

        let coins = 50;
        let suns = 0;
        let currentLevel = 1;
        let plants = [];
        let zombies = [];
        let levelProgress = 0;
        let selectedPlant = null;
        let gameWidth = canvas.width;
        let gameHeight = canvas.height;
        let plantCost = {sunflower: 50, peashooter: 100}; // Example costs
        let plantTypes = {sunflower: {cost: 50, width: 80, height: 80, animation: ['sunflower1.png', 'sunflower2.png', 'sunflower3.png']},
                          peashooter: {cost: 100, width: 80, height: 80, animation: ['Peashooter1.png', 'Peashooter2.png', 'Peashooter3.png']}};
        let zombiesTypes = {normal: {speed: 1, animation: ['zombie_normal1.png', 'zombie_normal2.png', 'zombie_normal3.png']},
                            buckethead: {speed: 0.8, animation: ['zombie_buskethead1.png', 'zombie_buskethead2.png', 'zombie_buskethead3.png']},
                            conehead: {speed: 0.9, animation: ['zombie_conehead1.png', 'zombie_conehead2.png', 'zombie_conehead3.png']},
                            runner: {speed: 1.2, animation: ['zombie_runner1.png', 'zombie_runner2.png', 'zombie_runner3.png']}};

        function loadImage(src) {
            return new Promise((resolve) => {
                const img = new Image();
                img.src = src;
                img.onload = () => resolve(img);
            });
        }

        function drawPlant(type, x, y) {
            const plant = {
                type: type,
                x: x,
                y: y,
                width: 80,
                height: 80,
                animationIndex: 0,
                animation: plantTypes[type].animation
            };
            plants.push(plant);
            const imgSrc = `https://github.com/afanasi555/pvz/blob/main/assets/res/normal/${plant.animation[0]}?raw=true`;
            loadImage(imgSrc).then((img) => {
                ctx.drawImage(img, x, y, plant.width, plant.height);
            });
        }

        function updateStatus() {
            coinsElem.textContent = coins;
            sunsElem.textContent = suns;
        }

        function showEndScreen() {
            endScreen.style.display = 'block';
        }

        function closeShop() {
            shop.style.display = 'none';
        }

        function updateProgress() {
            progressElem.textContent = `${levelProgress}%`;
        }

        function initializeLevel() {
            // Initialize level with zombies and other game elements
            levelProgress = 0;
            updateProgress();
        }

        function handleClick(event) {
            if (selectedPlant) {
                const rect = canvas.getBoundingClientRect();
                const x = event.clientX - rect.left;
                const y = event.clientY - rect.top;
                if (suns >= plantTypes[selectedPlant].cost) {
                    suns -= plantTypes[selectedPlant].cost;
                    drawPlant(selectedPlant, x, y);
                } else {
                    alert('Not enough suns!');
                }
                selectedPlant = null;
            }
        }

        function handlePlantClick(event) {
            selectedPlant = event.target.dataset.type;
        }

        function init() {
            updateStatus();
            initializeLevel();
            document.getElementById('plantOptions').addEventListener('click', handlePlantClick);
            canvas.addEventListener('click', handleClick);
            closeShopButton.addEventListener('click', closeShop);
            continueButton.addEventListener('click', () => {
                endScreen.style.display = 'none';
                initializeLevel();
            });
        }

        init();
    </script>
</body>
</html>
